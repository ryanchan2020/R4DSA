read_folder <- function(infolder) {
tibble(file = dir(infolder,
full.names = TRUE)) %>%
mutate(text = map(file,
read_lines)) %>%
transmute(id = basename(file),
text) %>%
unnest(text)
}
raw_text <- tibble(folder =
dir(news20,
full.names = TRUE)) %>%
mutate(folder_out = map(folder,
read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder),
id, text)
write_rds(raw_text, "data/rds/news20")
View(raw_text)
raw_text <- tibble(folder =
dir(news20,
full.names = TRUE)) %>%
mutate(folder_out = map(folder,
read_folder)) %>%
unnest(cols = c(folder_out)) %>%
transmute(newsgroup = basename(folder),
id, text)
write_rds(raw_text, "data/rds/news20.rds")
View(raw_text)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>%
ggplot(aes(messages, newsgroup)) +
geom_col(fill = 'lightbulb') +
labs(y = NULL)
raw_text %>%
group_by(newsgroup) %>%
summarise(messages = n_distinct(id)) %>%
ggplot(aes(messages, newsgroup)) +
geom_col(fill = 'lightblue') +
labs(y = NULL)
cleaned_text <- raw_text %>%
group_by(newsgroup, id) %>%
filter(cumsum(text == '') > 0,
cumsum(str_detect(
text, "^--")) == 0) %>%
ungroup()
View(cleaned_text)
View(cleaned_text)
cleaned_text <- cleaned_text %>%
filter(str_detect(text, "^[^>]+[A-Za-z\\d]")
| text == "",
!str_detect(text,
"writes(:|\\.\\.\\.)$"),
!str_detect(text,
"^In article <")
)
usenet_words <- cleaned_text %>%
unnest_tokens(word, text) %>%
filter(str_detect(word, "[a-z']$"),
!word %in% stop_words$word)
View(usenet_words)
usenet_words %>%
count(word, sort = TRUE)
words_by_newsgroup <- usenet_words %>%
count(newsgroup, word, sort = TRUE) %>%
ungroup()
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300)
DTOutput(words_by_newsgroup)
View(words_by_newsgroup)
DTOutput(words_by_newsgroup(word))
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,
colors=brewer.pal(8, "Dark2"))
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,
colors=brewer.pal(8, "Dark2"))
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,
colors=brewer.pal(8, "Dark2"))
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=FALSE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
set.seed(1234)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
set.seed(1234)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
set.seed(1234)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"))
set.seed(1234)
words_by_newsgroup %>%
filter(n > 0) %>%
ggplot(aes(label = word,
size = n)) +
geom_text_wordcloud() +
theme_minimal() +
facet_wrap(~newsgroup)
set.seed(1234)
words_by_newsgroup %>%
filter(n > 0) %>%
ggplot(aes(label = word,
size = n)) +
geom_text_wordcloud() +
theme_minimal() +
facet_wrap(~newsgroup)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale = 10)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale = 4)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2")
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(4,.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(8,.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,1)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,0.2)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,0.7)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,0.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(0.5,0.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(0.5,1)
)
tf_idf <- words_by_newsgroup %>%
bind_tf_idf(word, newsgroup, n) %>%
arrange(desc(tf_idf))
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1,0.6)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(2,0.5)
)
set.seed(230)
wordcloud(words_by_newsgroup$word,
words_by_newsgroup$n,
max.words = 300,
random.order=TRUE,
random.color = FALSE,
colors=brewer.pal(8, "Dark2"),
scale=c(1.5,0.5)
)
View(tf_idf)
datatable(tf_idf)
DT::datatable(tf_idf, filter = 'top') %>%
formatRound(columns = c('tf', 'idf','tf_idf'),
digits = 3) %>%
formatStyle(0,
target = 'row',
lineHeight = '25%')
tf_idf %>%
filter(str_detect(newsgroup, '^sci\\.')) %>%
group_by(newsgroup) %>%
slice_max(tf_idf,
n=12) %>%
ungroup() %>%
mutate(word = reorder(word,
tf_idf)) %>%
ggplot(aes(tf_idf,
word,
fill = newsgroup)) +
geom_col(show.legend = FALSE) +
facet_wrap(~newsgroup,
scales = 'free') +
labs(x = 'TF_IDF', y = NULL)
tf_idf <- words_by_newsgroup %>%
bind_tf_idf(word, newsgroups, n) %>%
arrange(desc(tf_idf))
tf_idf <- words_by_newsgroup %>%
bind_tf_idf(word, newsgroup, n) %>%
arrange(desc(tf_idf))
View(tf_idf)
newsgroup_cors <- words_by_newsgroup %>%
pairwise_cor(newsgroup,
word,
n,
sort = TRUE)
View(newsgroup_cors)
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(sie = 6,
colour = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(sie = 6,
colour = 'lightblue') +
geom_node_text(aes(label = name,
colour = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(sie = 6,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(sie = 2,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(size = 6,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(size = 2,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(size = 6,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr', size = 0.25) +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(size = 6,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
set.seed(2017)
newsgroup_cors %>%
filter(correlation > 0.025) %>%
graph_from_data_frame() %>%
ggraph(layout = 'fr') +
geom_edge_link(aes(alpha = correlation,
width = correlation)) +
geom_node_point(size = 6,
color = 'lightblue') +
geom_node_text(aes(label = name,
color = 'red',
repel = TRUE)) +
theme_void()
bigrams <- cleaned_text %>%
unnest_tokens(bigram, text, token = 'ngrams', n=2)
bigrams_count <- bigrams %>%
filter(bigram != 'NA') %>%
count(bigram, sort = TRUE)
bigrams_separated <- bigrams %>%
filter(bigram != 'NA') %>%
separate(bigram, c('word1','word2'),
sep = ' ')
bigrams_filtered <- bigrams_separated %>%
filter(!word1 %in% stop_words$word) %>%
filter(!word2 %in% stop_words$word)
bigrams_count <- bigrams %>%
filter(bigram != 'NA') %>%
count(bigram, sort = TRUE)
bigram_graph <- bigrams_counts %>%
filter(n > 3) %>%
graph_from_data_frame()
bigram_graph <- bigrams_count %>%
filter(n > 3) %>%
graph_from_data_frame()
bigram_graph
bigram_counts <- bigrams_filtered %>%
count(word1, word2, sort = TRUE)
bigram_graph <- bigram_counts %>%
filter(n > 3) %>%
graph_from_data_frame()
bigram_graph
bigram_counts <- bigrams_filtered %>%
count(word1, word2, sort = TRUE)
set.seed(1234)
ggraph(bigram_graph, layout = 'fr') +
geom_edge_link() +
geom_node_point() +
geom_node_text(aes(label = name,
vjust = 1,
hjust = 1))
set.seed(1234)
a <- grid::arrow(type = 'closed',
length = unit(.15, 'inches'))
ggraph(bigram_graph, layout = 'fr') +
geom_edge_link(aes(edge_alpha = n),
show.legend = FALSE,
arrow = a,
end_cap = circle(.07, 'inches')) +
geom_node_point(color = 'lightblue', size = 5) +
geom_node_text(aes(label = name,
vjust = 1,
hjust = 1)) +
theme_void()
set.seed(1234)
a <- grid::arrow(type = 'closed',
length = unit(.15, 'inches'))
ggraph(bigram_graph, layout = 'fr') +
geom_edge_link(aes(edge_alpha = n),
show.legend = FALSE,
arrow = a,
end_cap = circle(.07, 'inches')) +
geom_node_point(color = 'lightblue', size = 5) +
geom_node_text(aes(label = name,
vjust = 1,
hjust = 1)) +
theme_void()
